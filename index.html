<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Claire's Learning Party!</title>
    <style>
        /* --- GLOBAL STYLES --- */
        body {
            font-family: 'Comic Sans MS', 'Chalkboard SE', sans-serif;
            background-color: #ffe6f2;
            background-image: radial-gradient(#ffc0cb 3px, transparent 3px);
            background-size: 30px 30px;
            height: 100dvh; 
            width: 100vw;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            overflow: hidden; 
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
        }

        /* --- MODE SWITCHER --- */
        .nav-bar {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            margin-bottom: 10px;
            z-index: 10;
        }
        
        .mode-btn {
            padding: 10px 20px;
            border-radius: 20px;
            border: none;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1);
            transition: transform 0.1s;
        }
        
        .mode-btn:active { transform: translateY(2px); box-shadow: none; }
        
        .btn-active { border: 3px solid white; transform: scale(1.1); }
        
        #btn-abc { background-color: #ff69b4; color: white; }
        #btn-123 { background-color: #20c997; color: white; }

        /* --- MAIN CARD --- */
        .card-container {
            background: white;
            width: 85%;
            max-width: 450px;
            height: 65vh;
            border-radius: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            border: 8px solid #ff69b4; /* Default Pink */
            overflow: hidden;
            background-color: #fff0f5;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        .card-container:active { transform: scale(0.98); }

        /* --- CONTENT AREAS --- */
        #word-display {
            font-size: clamp(3.5rem, 15vw, 6rem); 
            font-weight: bold;
            color: #333;
            text-align: center;
            padding: 10px;
            line-height: 1.1;
            display: none; /* Hidden by default */
        }

        #math-display {
            display: none; /* Hidden by default */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
        }

        /* --- NUMBER BLOCKS STYLES --- */
        .math-equation {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 2rem;
            color: #555;
            margin-bottom: 20px;
        }
        
        .block-stack {
            display: flex;
            flex-direction: column-reverse; /* Stack from bottom up */
            gap: 2px;
            align-items: center;
        }

        .block {
            width: 35px;
            height: 35px;
            border-radius: 4px;
            border: 2px solid rgba(0,0,0,0.1);
            box-shadow: inset 0 0 10px rgba(255,255,255,0.4);
            position: relative;
        }
        
        /* Face on the top block */
        .block:last-child::after {
            content: "üëÄ";
            font-size: 20px;
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
        }

        .operator { font-size: 3rem; font-weight: bold; color: #888; margin: 0 10px; }

        /* NumberBlock Colors */
        .bg-1 { background: #ff4d4d; } /* Red */
        .bg-2 { background: #ff9f43; } /* Orange */
        .bg-3 { background: #feca57; } /* Yellow */
        .bg-4 { background: #1dd1a1; } /* Green */
        .bg-5 { background: #54a0ff; } /* Blue */
        .bg-6 { background: #5f27cd; } /* Purple */
        .bg-7 { background: #ff9ff3; } /* Pink/Rainbow */
        .bg-8 { background: #ff00d4; } /* Magenta */
        .bg-9 { background: #c8d6e5; } /* Grey */
        .bg-10 { background: white; border: 2px solid #ff4d4d; } 

        .math-answer {
            font-size: 4rem;
            font-weight: bold;
            color: #333;
            margin-top: 20px;
        }

        /* --- REWARD SYSTEM --- */
        #reward-image {
            display: none;
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0; left: 0;
            z-index: 20;
        }

        #loading-text {
            display: none;
            font-size: 1.5rem;
            color: #ff69b4;
            animation: pulse 1s infinite;
            position: absolute;
            z-index: 10;
        }

        .instruction {
            margin-top: 15px;
            color: #d63384;
            font-size: 1rem;
            opacity: 0.8;
            pointer-events: none;
        }

        /* --- ANIMATIONS --- */
        @keyframes pulse { 0% { opacity: 0.5; } 100% { opacity: 1; } }
        
        .sparkle {
            position: absolute;
            width: 15px; height: 15px;
            background-color: gold;
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
            animation: fall linear forwards;
            z-index: 100; pointer-events: none; 
        }
        @keyframes fall { to { transform: translateY(100vh) rotate(360deg); } }

    </style>
</head>
<body>

    <div class="nav-bar">
        <button id="btn-abc" class="mode-btn btn-active" onclick="setMode('abc')">ABC Words</button>
        <button id="btn-123" class="mode-btn" onclick="setMode('123')">123 Math</button>
    </div>

    <div class="card-container" id="main-card" onclick="handleCardClick()">
        
        <div id="word-display">Start</div>

        <div id="math-display">
            <div class="math-equation" id="math-visuals">
                </div>
            <div class="math-answer" id="math-text">2 + 1 = ?</div>
        </div>

        <div id="loading-text">Finding a cat... üê±</div>
        <img id="reward-image" src="" alt="Reward">
        
    </div>

    <div class="instruction" id="instruction-text">(Tap to reveal answer)</div>

    <script>
        /* --- CONFIGURATION --- */
        const WORD_LIST = [
            // User requested
            "the", "and", "on", "for", "about", "then", 
            // Pre-K / Kindergarten High Frequency
            "a", "at", "big", "blue", "can", "come", "down", "find", "funny", "go", 
            "help", "here", "I", "in", "is", "it", "jump", "little", "look", "make", 
            "me", "my", "not", "one", "play", "red", "run", "said", "see", "three", 
            "to", "two", "up", "we", "where", "yellow", "you",
            // First Grade High Frequency
            "after", "again", "an", "any", "as", "ask", "by", "could", "every", "fly", 
            "from", "give", "going", "had", "has", "her", "him", "his", "how", "just", 
            "know", "let", "live", "may", "of", "old", "once", "open", "over", "put", 
            "round", "some", "stop", "take", "thank", "them", "think", "walk", "were", "when"
        ];

        /* --- STATE --- */
        let currentMode = 'abc'; // 'abc' or '123'
        let isShowingReward = false;
        let isShowingMathAnswer = false; // Math has a 2-step process (Question -> Answer -> Reward)
        
        // Math State
        let currentNum1 = 0;
        let currentNum2 = 0;
        let isAddition = true;

        /* --- ELEMENTS --- */
        const card = document.getElementById('main-card');
        const wordDisplay = document.getElementById('word-display');
        const mathDisplay = document.getElementById('math-display');
        const mathVisuals = document.getElementById('math-visuals');
        const mathText = document.getElementById('math-text');
        const rewardImage = document.getElementById('reward-image');
        const loadingText = document.getElementById('loading-text');
        const btnAbc = document.getElementById('btn-abc');
        const btn123 = document.getElementById('btn-123');
        const instruction = document.getElementById('instruction-text');

        // Init
        setMode('abc');

        /* --- LOGIC --- */

        function setMode(mode) {
            currentMode = mode;
            isShowingReward = false;
            isShowingMathAnswer = false;
            rewardImage.style.display = 'none';

            // Update Buttons
            if (mode === 'abc') {
                btnAbc.classList.add('btn-active');
                btn123.classList.remove('btn-active');
                card.style.borderColor = "#ff69b4"; // Pink
                
                // Show Words
                wordDisplay.style.display = 'block';
                mathDisplay.style.display = 'none';
                instruction.innerText = "(Tap for next word)";
                nextWord();
            } else {
                btnAbc.classList.remove('btn-active');
                btn123.classList.add('btn-active');
                card.style.borderColor = "#20c997"; // Teal
                
                // Show Math
                wordDisplay.style.display = 'none';
                mathDisplay.style.display = 'flex';
                instruction.innerText = "(Tap to solve)";
                nextMathProblem();
            }
        }

        function handleCardClick() {
            if (isShowingReward) {
                // CLEAR REWARD -> GO TO NEXT QUESTION
                hideReward();
                if (currentMode === 'abc') nextWord();
                else nextMathProblem();
            } else {
                // IN GAMEPLAY
                if (currentMode === 'abc') {
                    // Words: Tap immediately gives reward
                    showReward();
                } else {
                    // Math: Tap reveals answer, Tap again gives reward
                    if (!isShowingMathAnswer) {
                        revealMathAnswer();
                    } else {
                        showReward();
                    }
                }
            }
        }

        /* --- WORD LOGIC --- */
        function nextWord() {
            const r = Math.floor(Math.random() * WORD_LIST.length);
            wordDisplay.innerText = WORD_LIST[r];
        }

        /* --- MATH LOGIC --- */
        function nextMathProblem() {
            isShowingMathAnswer = false;
            mathText.style.color = "#333";
            
            // Generate Problem (Simple sums up to 10)
            isAddition = Math.random() > 0.3; // 70% addition, 30% subtraction
            
            if (isAddition) {
                currentNum1 = Math.floor(Math.random() * 5) + 1; // 1-5
                currentNum2 = Math.floor(Math.random() * 5) + 1; // 1-5
                mathText.innerText = `${currentNum1} + ${currentNum2} = ?`;
                renderBlocks(currentNum1, currentNum2, '+');
            } else {
                // Subtraction (Ensure positive result)
                currentNum1 = Math.floor(Math.random() * 5) + 3; // 3-8
                currentNum2 = Math.floor(Math.random() * (currentNum1 - 1)) + 1; // Less than num1
                mathText.innerText = `${currentNum1} - ${currentNum2} = ?`;
                renderBlocks(currentNum1, currentNum2, '-');
            }
        }

        function revealMathAnswer() {
            isShowingMathAnswer = true;
            let ans = isAddition ? (currentNum1 + currentNum2) : (currentNum1 - currentNum2);
            mathText.innerText = `${isAddition ? '+' : '-'}  ${ans} !`;
            mathText.style.color = "#d63384";
            
            // Visual feedback: Show the Result Block Stack
            renderAnswerBlocks(ans);
            instruction.innerText = "(Tap for a cat!)";
        }

        /* --- VISUAL BLOCKS GENERATOR --- */
        function renderBlocks(n1, n2, op) {
            mathVisuals.innerHTML = '';
            mathVisuals.appendChild(createBlockStack(n1));
            
            const operatorSpan = document.createElement('div');
            operatorSpan.className = 'operator';
            operatorSpan.innerText = op;
            mathVisuals.appendChild(operatorSpan);
            
            mathVisuals.appendChild(createBlockStack(n2));
        }

        function renderAnswerBlocks(total) {
            mathVisuals.innerHTML = '';
            // For answer, we just show one big stack
            mathVisuals.appendChild(createBlockStack(total));
        }

        function createBlockStack(num) {
            const stack = document.createElement('div');
            stack.className = 'block-stack';
            
            // Cap at 10 for visuals so it fits
            const count = Math.min(num, 10);
            
            for (let i = 0; i < count; i++) {
                const block = document.createElement('div');
                block.className = `block bg-${num}`; // Color matches the NUMBER (Numberblocks logic)
                stack.appendChild(block);
            }
            return stack;
        }

        /* --- REWARD LOGIC --- */
        function showReward() {
            isShowingReward = true;
            loadingText.style.display = 'block';
            
            // Get unique cat
            const uniqueId = new Date().getTime();
            const newCatUrl = `https://loremflickr.com/500/500/kitten?lock=${uniqueId}`;
            
            const img = new Image();
            img.onload = () => {
                loadingText.style.display = 'none';
                rewardImage.src = newCatUrl;
                rewardImage.style.display = 'block';
                createSparkles();
                instruction.innerText = "(Tap to play again)";
            };
            img.onerror = () => {
                // Backup
                loadingText.style.display = 'none';
                rewardImage.src = "https://cataas.com/cat?width=400";
                rewardImage.style.display = 'block';
                createSparkles();
            };
            img.src = newCatUrl;
        }

        function hideReward() {
            isShowingReward = false;
            rewardImage.style.display = 'none';
            instruction.innerText = currentMode === 'abc' ? "(Tap for next word)" : "(Tap to solve)";
        }

        function createSparkles() {
            const colors = ['#ffd700', '#ff69b4', '#00ffff', '#ff1493'];
            for (let i = 0; i < 40; i++) {
                const s = document.createElement('div');
                s.className = 'sparkle';
                s.style.left = Math.random() * 100 + 'vw';
                s.style.top = '-20px';
                s.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                s.style.animationDuration = (Math.random() * 2 + 1) + 's';
                document.body.appendChild(s);
                setTimeout(() => s.remove(), 3000);
            }
        }
    </script>
</body>
</html>
